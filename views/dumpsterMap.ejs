<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dumpster FIRE</title>
  <link rel='stylesheet' href='/stylesheets/map.css' />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
  <script src="/javascripts/map.js"></script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXl5WzhM1ZWUSQYcQcz1_sFkX1EvHJrNc&callback=initMap&libraries=places&v=weekly"
    defer></script>
  <%- include('common.ejs') %>
    <script src="/selectize/js/standalone/selectize.js"></script>
    <link rel="stylesheet" href="/selectize/css/selectize.default.css">
</head>

<script type="text/javascript">
  $(document).ready(function () {
    $(".btn.add-dumpster").click(function () {
      console.log("Hello");
      location.href = '/dumpster/add';
    });
    $(".btn.add-depot").click(function () {
      console.log("Hello");
      $('#autocomplete').val('');
      $('.background').toggle();
    });
    $(".btn.confirm").click(function () {
      const place = autocomplete.getPlace();
      let lat = place.geometry.location.lat()
      let lng = place.geometry.location.lng()
      console.log("lat:", lat, "lng", lng);
      addDepot(lat,lng)
      $('.background').toggle();
    });
    initAutocomplete();
  });
  let placeSearch;
  var autocomplete;

  function initAutocomplete() {
    // Create the autocomplete object, restricting the search predictions to
    // geographical location types.
    autocomplete = new google.maps.places.Autocomplete(
      document.getElementById("autocomplete"),
      { types: ["geocode"] }
    );
    // Avoid paying for data that you don't need by restricting the set of
    // place fields that are returned to just the address components.
    autocomplete.setFields(["geometry/location "]);
 
  
  }





  function geolocate() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((position) => {
        const geolocation = {
          lat: position.coords.latitude,
          lng: position.coords.longitude,
        };
        const circle = new google.maps.Circle({
          center: geolocation,
          radius: position.coords.accuracy,
        });
        autocomplete.setBounds(circle.getBounds());
      });
    }
  }

</script>

<body>
  <%- include('messageBox.ejs') %>
  <%- include('header.ejs') %>
    <div class="wrapper">
      <%- include('nav.ejs') %>
        <div class="content">
          <div class="toolbar">
            <input class='btn primary-btn add-dumpster' type="button" value="Add Dumpster">
            <input class='btn primary-btn add-depot' type="button" value="Add Depot">
          </div>
          <div id="map"></div>
          <div class="background">
            <div class="input">
              <h2>Add Depot</h2>
              <div id="locationField">
                <input id="autocomplete" placeholder="Enter your address" onFocus="geolocate()" type="text" />
                <input class='btn primary-btn confirm' type="button" value="Add Depot">
              </div>
            </div>
          </div>
        </div>
    </div>
</body>

</html>